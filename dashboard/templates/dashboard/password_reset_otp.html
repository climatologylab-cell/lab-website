{% extends 'dashboard/base.html' %}

{% block title %}Verify OTP{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-5">
        <div class="login-card p-4 p-md-5">
            <div class="text-center mb-4">
                <div class="mb-3">
                    <i class="bi bi-key-fill text-warning" style="font-size: 3rem;"></i>
                </div>
                <h4 class="fw-700">Enter OTP</h4>
                <p class="text-muted">We've sent a 6-digit code to <strong>{{ email }}</strong></p>
            </div>

            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
            {% endif %}

            <form method="post">
                {% csrf_token %}
                <div class="mb-3 text-center">
                    <label class="form-label small fw-700 text-uppercase opacity-75">Verification Code</label>
                    {{ form.otp }}
                    {% if form.otp.errors %}
                    <div class="text-danger small mt-2">{{ form.otp.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="text-center mb-3">
                    <small class="text-muted">
                        <i class="bi bi-clock me-1"></i>
                        Code expires in <span id="countdown" class="fw-bold text-primary">--</span>
                    </small>
                </div>

                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary fw-600 py-2" id="verifyBtn">
                        <i class="bi bi-check-circle-fill me-2"></i>Verify OTP
                    </button>
                </div>
            </form>

            <div class="text-center mt-4">
                <a href="{% url 'dashboard:password_reset' %}" class="text-decoration-none small text-muted">
                    <i class="bi bi-arrow-left"></i> Didn't receive it? Request again
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    (function () {
        var remaining = {{ remaining_seconds }
    };
    var el = document.getElementById('countdown');
    var btn = document.getElementById('verifyBtn');
    function update() {
        var m = Math.floor(remaining / 60);
        var s = remaining % 60;
        el.textContent = (m > 0 ? m + 'm ' : '') + s + 's';
    }
    update();
    var timer = setInterval(function () {
        remaining--;
        if (remaining <= 0) {
            clearInterval(timer);
            el.textContent = 'Expired';
            el.classList.remove('text-primary');
            el.classList.add('text-danger');
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-x-circle me-2"></i>OTP Expired';
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-secondary');
        } else {
            update();
        }
    }, 1000);
}) ();
</script>
{% endblock %}